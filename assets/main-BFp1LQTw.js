var ae=Object.defineProperty;var le=(u,e,t)=>e in u?ae(u,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):u[e]=t;var r=(u,e,t)=>(le(u,typeof e!="symbol"?e+"":e,t),t);import"./global-B6Ibca-s.js";const O=class O{constructor(e,t,i,n,s,l){r(this,"id");r(this,"displayName");r(this,"absorption");r(this,"efficiency");r(this,"moderation");r(this,"conductivity");this.id=e,this.displayName=t,this.absorption=i,this.efficiency=n,this.moderation=s,this.conductivity=l}};r(O,"EMPTY_MODERATOR",new O("empty","empty",0,0,1,0)),r(O,"FUEL_ROD",new O("biggerreactors:fuel_rod","Fuel Rod",0,0,0,0));let o=O;const $={extremereactors:{"biggerreactors:fuel_rod":o.FUEL_ROD,"minecraft:air":new o("minecraft:air","Air",.1,.25,1.1,.05),"forge:storage_block/apatite":new o("forge:storage_block/apatite","Apatite",.48,.73,1.3,.15),"forge:storage_block/cinnabar":new o("forge:storage_block/cinnabar","Cinnabar",.48,.75,1.32,.15),"forge:storage_blocks/iron":new o("forge:storage_blocks/iron","Iron",.5,.75,1.4,.6),"forge:storage_blocks/manasteel":new o("forge:storage_blocks/manasteel","Manasteel",.6,.75,1.5,.6),"forge:storage_blocks/elementium":new o("forge:storage_blocks/elementium","Elementium",.61,.77,1.52,2.5),"forge:storage_blocks/nickel":new o("forge:storage_blocks/nickel","Nickel",.51,.77,1.4,.6),"forge:storage_blocks/gold":new o("forge:storage_blocks/gold","Gold",.52,.8,1.45,2),"forge:storage_blocks/diamond":new o("forge:storage_blocks/diamond","Diamond",.55,.85,1.5,3),"forge:storage_blocks/netherite":new o("forge:storage_blocks/netherite","Netherite",.55,.95,1.65,3),"forge:storage_blocks/terrasteel":new o("forge:storage_blocks/terrasteel","Terrasteel",.57,.87,1.52,3),"forge:storage_blocks/emerald":new o("forge:storage_blocks/emerald","Emerald",.55,.85,1.5,2.5),"forge:glass/colorless":new o("forge:glass/colorless","Glass",.2,.25,1.1,.3),"forge:storage_blocks/copper":new o("forge:storage_blocks/copper","Copper",.5,.75,1.4,1),"forge:storage_blocks/brass":new o("forge:storage_blocks/brass","Brass",.52,.78,1.42,1),"forge:storage_blocks/osmium":new o("forge:storage_blocks/osmium","Osmium",.51,.77,1.41,1),"forge:storage_blocks/refined_obsidian":new o("forge:storage_blocks/refined_obsidian","Refined Obsidian",.53,.79,1.42,1),"forge:storage_blocks/refined_glowstone":new o("forge:storage_blocks/refined_glowstone","Refined Glowstone",.54,.79,1.44,2.5),"forge:storage_blocks/bronze":new o("forge:storage_blocks/bronze","Bronze",.51,.77,1.41,1),"forge:storage_blocks/zinc":new o("forge:storage_blocks/zinc","Zinc",.51,.77,1.41,1),"forge:storage_blocks/aluminum":new o("forge:storage_blocks/aluminum","Aluminum",.5,.78,1.42,.6),"forge:storage_blocks/steel":new o("forge:storage_blocks/steel","Steel",.5,.78,1.42,.6),"forge:storage_blocks/invar":new o("forge:storage_blocks/invar","Invar",.5,.79,1.43,.6),"forge:storage_blocks/tin":new o("forge:storage_blocks/tin","Tin",.5,.73,1.38,1.5),"forge:storage_blocks/silver":new o("forge:storage_blocks/silver","Silver",.51,.79,1.43,1.5),"forge:storage_blocks/signalum":new o("forge:storage_blocks/signalum","Signalum",.51,.75,1.42,1),"forge:storage_blocks/lumium":new o("forge:storage_blocks/lumium","Lumium",.51,.79,1.45,1.5),"forge:storage_blocks/lead":new o("forge:storage_blocks/lead","Lead",.75,.75,1.75,1.5),"forge:storage_blocks/electrum":new o("forge:storage_blocks/electrum","Electrum",.53,.82,1.47,2.2),"forge:storage_blocks/platinum":new o("forge:storage_blocks/platinum","Platinum",.57,.86,1.58,2.5),"forge:storage_blocks/enderium":new o("forge:storage_blocks/enderium","Enderium",.6,.88,1.6,3),"forge:storage_blocks/graphite":new o("forge:storage_blocks/graphite","Graphite",.1,.5,2,2),"minecraft:ice":new o("minecraft:ice","Ice",.33,.33,1.15,.1),"bigreactors:dry_ice":new o("bigreactors:dry_ice","Dry Ice",.42,.52,1.32,.1),"bigreactors:cryomisi":new o("bigreactors:cryomisi","Cryomisi",.75,.55,1.6,2.5),"bigreactors:cryomisi_flowing":new o("bigreactors:cryomisi_flowing","Cryomisi Flowing",.68,.49,1.4,2.5),"bigreactors:tangerium":new o("bigreactors:tangerium","Tangerium",.9,.75,2,2),"bigreactors:tangerium_flowing":new o("bigreactors:tangerium_flowing","Tangerium Flowing",.84,.69,1.7,2),"bigreactors:redfrigium":new o("bigreactors:redfrigium","Redfrigium",.66,.95,6,3),"bigreactors:redfrigium_flowing":new o("bigreactors:redfrigium_flowing","Redfrigium Flowing",.57,.86,5,3),"minecraft:water":new o("minecraft:water","Water",.33,.5,1.33,.1),"minecraft:flowing_water":new o("minecraft:flowing_water","Flowing Water",.33,.5,1.33,.1),"astralsorcery:liquid_starlight":new o("astralsorcery:liquid_starlight","Liquid Starlight",.92,.8,2,3),"astralsorcery:liquid_starlight_flowing":new o("astralsorcery:liquid_starlight_flowing","Liquid Starlight Flowing",.8,.85,2,3),"bloodmagic:life_essence_fluid":new o("bloodmagic:life_essence_fluid","Life Essence Fluid",.8,.55,1.75,2.5),"bloodmagic:life_essence_fluid_flowing":new o("bloodmagic:life_essence_fluid_flowing","Life Essence Fluid Flowing",.7,.55,1.75,2.5),"mekanism:hydrofluoric_acid":new o("mekanism:hydrofluoric_acid","Hydrofluoric Acid",.68,.45,1.4,2.5),"mekanism:flowing_hydrofluoric_acid":new o("mekanism:flowing_hydrofluoric_acid","Flowing Hydrofluoric Acid",.6,.45,1.4,2.5),"mekanism:sodium":new o("mekanism:sodium","Sodium",.28,.6,1.7,1),"mekanism:flowing_sodium":new o("mekanism:flowing_sodium","Flowing Sodium",.23,.6,1.7,1),"mekanism:hydrogen_chloride":new o("mekanism:hydrogen_chloride","Hydrogen Chloride",.38,.65,1.7,1),"mekanism:flowing_hydrogen_chloride":new o("mekanism:flowing_hydrogen_chloride","Flowing Hydrogen Chloride",.31,.65,1.7,1),"mekanism:ethene":new o("mekanism:ethene","Ethene",.45,.65,1.9,1.5),"mekanism:flowing_ethene":new o("mekanism:flowing_ethene","Flowing Ethene",.37,.65,1.9,1.5),"thermal:ender":new o("thermal:ender","Ender",.92,.76,2.02,2),"thermal:ender_flowing":new o("thermal:ender_flowing","Ender Flowing",.9,.75,2,2),"thermal:redstone":new o("thermal:redstone","Redstone",.77,.56,1.61,2.5),"thermal:redstone_flowing":new o("thermal:redstone_flowing","Redstone Flowing",.75,.55,1.6,2.5)},biggerreactors:{"biggerreactors:fuel_rod":o.FUEL_ROD,"biggerreactors:ludicrite_block":new o("biggerreactors:ludicrite_block","Ludicrite Block",.6,.87,3,3),"bloodmagic:life_essence_block":new o("bloodmagic:life_essence_block","Life Essence Block",.7,.55,1.75,2.5),"mekanism:ethene":new o("mekanism:ethene","Ethene",.37,.65,1.9,1.5),"mekanism:hydrofluoric_acid":new o("mekanism:hydrofluoric_acid","Hydrofluoric Acid",.6,.45,1.4,2.5),"mekanism:hydrogen":new o("mekanism:hydrogen","Hydrogen",.2,.3,1.2,.1),"mekanism:hydrogen_chloride":new o("mekanism:hydrogen_chloride","Hydrogen Chloride",.31,.65,1.7,1),"mekanism:lithium":new o("mekanism:lithium","Lithium",.7,.6,1.04,.7),"mekanism:oxygen":new o("mekanism:oxygen","Oxygen",.01,.35,1.04,.1),"mekanism:sodium":new o("mekanism:sodium","Sodium",.23,.6,1.7,1),"mekanism:steam":new o("mekanism:steam","Steam",.33,.5,1.33,.5),"mekanismgenerators:deuterium":new o("mekanismgenerators:deuterium","Deuterium",.03,.3,1.07,.1),"minecraft:air":new o("minecraft:air","Air",.1,.25,1.1,.05),"minecraft:glass":new o("minecraft:glass","Glass",.2,.25,1.1,.3),"minecraft:ice":new o("minecraft:ice","Ice",.33,.33,1.15,.1),"minecraft:snow_block":new o("minecraft:snow_block","Snow Block",.15,.33,1.05,.05),"minecraft:water":new o("minecraft:water","Water",.33,.5,1.33,.1),"minecraft:lava":new o("minecraft:lava","Lava",.33,.33,1.15,.7),"forge:storage_blocks/allthemodium":new o("forge:storage_blocks/allthemodium","Allthemodium",.66,.9,3.5,3.5),"forge:storage_blocks/aluminum":new o("forge:storage_blocks/aluminum","Aluminum",.5,.78,1.42,.6),"forge:storage_blocks/bronze":new o("forge:storage_blocks/bronze","Bronze",.51,.77,1.41,1),"forge:storage_blocks/copper":new o("forge:storage_blocks/copper","Copper",.5,.75,1.4,1),"forge:storage_blocks/diamond":new o("forge:storage_blocks/diamond","Diamond",.55,.85,1.5,3),"forge:storage_blocks/electrum":new o("forge:storage_blocks/electrum","Electrum",.53,.82,1.47,2.2),"forge:storage_blocks/emerald":new o("forge:storage_blocks/emerald","Emerald",.55,.85,1.5,2.5),"forge:storage_blocks/enderium":new o("forge:storage_blocks/enderium","Enderium",.53,.88,1.6,3),"forge:storage_blocks/gold":new o("forge:storage_blocks/gold","Gold",.52,.8,1.45,2),"forge:storage_blocks/graphite":new o("forge:storage_blocks/graphite","Graphite",.1,.5,2,2),"forge:storage_blocks/invar":new o("forge:storage_blocks/invar","Invar",.5,.79,1.43,.6),"forge:storage_blocks/iron":new o("forge:storage_blocks/iron","Iron",.5,.75,1.4,.6),"forge:storage_blocks/lead":new o("forge:storage_blocks/lead","Lead",.75,.75,1.75,1.5),"forge:storage_blocks/lumium":new o("forge:storage_blocks/lumium","Lumium",.75,.55,1.5,1.8),"forge:storage_blocks/nickel":new o("forge:storage_blocks/nickel","Nickel",.5,.82,1.46,.6),"forge:storage_blocks/osmium":new o("forge:storage_blocks/osmium","Osmium",.51,.77,1.41,1),"forge:storage_blocks/platinum":new o("forge:storage_blocks/platinum","Platinum",.53,.86,1.58,2.5),"forge:storage_blocks/signalum":new o("forge:storage_blocks/signalum","Signalum",.63,.66,1.5,1.8),"forge:storage_blocks/silver":new o("forge:storage_blocks/silver","Silver",.51,.79,1.43,1.5),"forge:storage_blocks/steel":new o("forge:storage_blocks/steel","Steel",.5,.78,1.42,.6),"forge:storage_blocks/tin":new o("forge:storage_blocks/tin","Tin",.3,.7,1.35,.75),"forge:storage_blocks/unobtainium":new o("forge:storage_blocks/unobtainium","Unobtainium",.95,.82,2,5),"forge:storage_blocks/vibranium":new o("forge:storage_blocks/vibranium","Vibranium",.15,.75,8,4),"forge:storage_blocks/zinc":new o("forge:storage_blocks/zinc","Zinc",.51,.77,1.41,1),"biggerreactors:liquid_obsidian":new o("biggerreactors:liquid_obsidian","Liquid Obsidian",.3,.7,1.35,.75),"allthemodium:molten_allthemodium":new o("allthemodium:molten_allthemodium","Molten Allthemodium",.66,.9,3.5,3.5),"allthemodium:molten_vibranium":new o("allthemodium:molten_vibranium","Molten Vibranium",.15,.75,8,4),"allthemodium:molten_unobtainium":new o("allthemodium:molten_unobtainium","Molten Unobtainium",.95,.82,2,5),"allthemodium:vapor_allthemodium":new o("allthemodium:vapor_allthemodium","Allthemodium Vapor",.66,.9,3.5,3.5),"allthemodium:vapor_vibranium":new o("allthemodium:vapor_vibranium","Vibranium Vapor",.15,.75,8,4),"allthemodium:vapor_unobtainium":new o("allthemodium:vapor_unobtainium","Unobtainium Vapor",.95,.82,2,5),"forge:superheated_sodium":new o("forge:superheated_sodium","Superheated Sodium",.23,.6,1.7,1)}};class ue{constructor(){r(this,"x",0);r(this,"y",0);r(this,"z",0);r(this,"defaultModeratorProperties",o.EMPTY_MODERATOR);r(this,"moderatorProperties",[]);r(this,"manifoldLocations",[]);r(this,"manifoldCount",0);r(this,"controlRodLocations",[]);r(this,"controlRodCount",0);r(this,"passivelyCooled",!0);r(this,"ambientTemperature",273.15)}setSize(e,t,i){if(!(e<=0||t<=0||i<=0)){this.x=e,this.y=t,this.z=i,this.moderatorProperties=[],this.manifoldLocations=[],this.manifoldCount=0;for(let n=0;n<e;n++){let s=[],l=[];for(let a=0;a<t;a++){let c=[],m=[];for(let d=0;d<i;d++)c.push(this.defaultModeratorProperties),m.push(!1);s.push(c),l.push(m)}this.moderatorProperties.push(s),this.manifoldLocations.push(l)}this.controlRodLocations=[],this.controlRodCount=0;for(let n=0;n<e;n++){let s=[];for(let l=0;l<i;l++)s.push(!1);this.controlRodLocations.push(s)}}}setModeratorProperties(e,t,i,n){this.moderatorProperties!=null&&(e<0||e>=this.moderatorProperties.length||t<0||t>=this.moderatorProperties[0].length||i<0||i>=this.moderatorProperties[0][0].length||(this.moderatorProperties[e][t][i]=n))}setControlRod(e,t,i){this.controlRodLocations!=null&&(e<0||e>=this.controlRodLocations.length||t<0||t>=this.controlRodLocations[0].length||(this.controlRodLocations[e][t]!=i&&(this.controlRodCount+=i?1:-1),this.controlRodLocations[e][t]=i))}setManifold(e,t,i,n){this.manifoldLocations!=null&&(e<0||e>=this.manifoldLocations.length||t<0||t>=this.manifoldLocations[0].length||i<0||i>=this.manifoldLocations[0][0].length||(this.manifoldLocations[e][t][i]!=n&&(this.manifoldCount+=n?1:-1),this.manifoldLocations[e][t][i]=n))}}const f={Reactor:{FuelUsageMultiplier:1,OutputMultiplier:1,PassiveOutputMultiplier:.5,ActiveOutputMultiplier:1,FuelMBPerIngot:1e3,PerFuelRodCapacity:4e3,FuelFertilityMinimumDecay:.1,FuelFertilityDecayDenominator:20,FuelFertilityDecayDenominatorInactiveMultiplier:200,CasingHeatTransferRFMKT:.6,FuelToStackRFKTMultiplier:1,StackToCoolantRFMKT:.6,StackToAmbientRFMKT:.001,PassiveBatteryPerExternalBlock:1e5,PassiveCoolingTransferEfficiency:.2,CoolantTankAmountPerFuelRod:1e4,CaseFEPerUnitVolumeKelvin:10,RodFEPerUnitVolumeKelvin:10,FuelReactivity:1.05,FissionEventsPerFuelUnit:.1,FEPerRadiationUnit:10,FuelPerRadiationUnit:7e-4,IrradiationDistance:4,FuelHardnessDivisor:1,FuelAbsorptionCoefficient:.5,FuelModerationFactor:1.5,RadIntensityScalingMultiplier:.95,RadIntensityScalingRateExponentMultiplier:1.2,RadIntensityScalingShiftMultiplier:1,RadPenaltyShiftMultiplier:15,RadPenaltyRateMultiplier:2.5,FuelAbsorptionScalingMultiplier:.95,FuelAbsorptionScalingShiftMultiplier:1,FuelAbsorptionScalingRateExponentMultiplier:2.2,fuelRadScalingMultiplier:1},Turbine:{FlowRatePerBlock:5e3,TankVolumePerBlock:1e4,FluidPerBladeLinerKilometre:20,RotorAxialMassPerShaft:100,RotorAxialMassPerBlade:100,FrictionDragMultiplier:5e-4,AerodynamicDragMultiplier:5e-4,CoilDragMultiplier:10,BatterySizePerCoilBlock:3e5},SimulationRays:64,HeatDisplayMax:2e3,ControlRodBatchSize:32};class V{constructor(){r(this,"isInfinite",!1);r(this,"rfPerKelvin",0);r(this,"temperature",0)}transferWith(e,t){if(this.isInfinite&&e.isInfinite)return 0;if(!this.isInfinite&&e.isInfinite)return-e.transferWith(this,t);let i;if(this.isInfinite){let n=e.temperature-this.temperature;n*=Math.exp(-t/e.rfPerKelvin),n+=this.temperature,i=(n-e.temperature)*e.rfPerKelvin,e.temperature=n}else{let n=this.rfPerKelvin*(this.temperature-e.temperature)/(this.rfPerKelvin+e.rfPerKelvin);n+=e.temperature;let s=t*(this.rfPerKelvin+e.rfPerKelvin);s/=this.rfPerKelvin*e.rfPerKelvin,s=Math.exp(-s);let l=this.temperature-n;l*=s,l+=n;let a=e.temperature-n;a*=s,a+=n,i=(a-e.temperature)*e.rfPerKelvin,this.temperature=l,e.temperature=a}return i}additionalRFForTemperature(e){let t=this.rfFromTemperature(this.temperature);return this.rfFromTemperature(e)-t}temperatureWithAdditionalRF(e){return this.temperature+(this.isInfinite?0:e/this.rfPerKelvin)}absorbRF(e){return this.temperature=this.temperatureWithAdditionalRF(e),e}rfFromTemperature(e){return e*this.rfPerKelvin}rf(){return this.rfFromTemperature(this.temperature)}tempFromRF(e){return e/this.rfPerKelvin}}class ce extends V{constructor(t){super();r(this,"capacity");r(this,"stored",0);r(this,"generatedLastTick",0);this.capacity=t}transferWith(t,i){let n=t.temperature-this.temperature;n*=Math.exp(-i/t.rfPerKelvin),n+=this.temperature;let s=(n-t.temperature)*t.rfPerKelvin;return this.generatedLastTick=-s*f.Reactor.OutputMultiplier*f.Reactor.PassiveOutputMultiplier,this.stored+=this.generatedLastTick,this.stored>this.capacity&&(this.stored=this.capacity),t.temperature=n,s}extract(t){return this.stored-=t,t}}let he=class{constructor(e,t){r(this,"x");r(this,"y");r(this,"insertion");this.x=e,this.y=t,this.insertion=0}};class G extends V{constructor(t,i){super();r(this,"perSideCapacity");r(this,"liquidAmount",0);r(this,"vaporAmount",0);r(this,"defaultModerator");r(this,"moderator",null);r(this,"transitionProperties",null);r(this,"maxTransitionedLastTick",0);r(this,"transitionedLastTick",0);r(this,"rfTransferredLastTick",0);this.perSideCapacity=t,this.defaultModerator=i,this.isInfinite=!0}transferWith(t,i){if(this.transitionProperties==null)return this.maxTransitionedLastTick=0,this.transitionedLastTick=0,this.rfTransferredLastTick=0,0;i*=this.transitionProperties.liquidRFMKT;let n=this.liquidAmount/this.perSideCapacity;i*=Math.max(n,.01);let s=t.temperature-this.transitionProperties.boilingPoint;s*=Math.exp(-i/t.rfPerKelvin),s+=this.transitionProperties.boilingPoint;let l=s-t.temperature;return l*=t.rfPerKelvin,l=this.absorbRF(l),t.absorbRF(l),-l}absorbRF(t){if(t>0||this.transitionProperties==null)return this.maxTransitionedLastTick=0,this.transitionedLastTick=0,this.rfTransferredLastTick=0,0;t=Math.abs(t);let i=t/this.transitionProperties.latentHeat,n=Math.min(this.liquidAmount,this.perSideCapacity-this.vaporAmount),s=f.Reactor.OutputMultiplier*f.Reactor.ActiveOutputMultiplier;return this.maxTransitionedLastTick=i*s,i=Math.min(n,i),this.transitionedLastTick=i*s,this.liquidAmount-=this.transitionedLastTick,this.vaporAmount+=this.transitionedLastTick,t=i*this.transitionProperties.latentHeat,this.rfTransferredLastTick=t,t*=-1,t}dumpLiquid(){this.liquidAmount=0}dumpVapor(){this.vaporAmount=0}insertLiquid(t){return this.liquidAmount+=t,t}extractLiquid(t){return this.liquidAmount-=t,t}insertVapor(t){return this.vaporAmount+=t,t}extractVapor(t){return this.vaporAmount-=t,t}setModeratorProperties(t){this.moderator=t}setTransitionProperties(t){this.transitionProperties=t}absorption(){if(this.perSideCapacity==0||this.moderator==null)return this.defaultModerator.absorption;let t=0;return t+=this.moderator.absorption*(this.perSideCapacity-this.liquidAmount),t+=this.moderator.absorption*this.liquidAmount,t/=this.perSideCapacity,t}heatEfficiency(){if(this.perSideCapacity==0||this.moderator==null)return this.defaultModerator.efficiency;let t=0;return t+=this.moderator.efficiency*(this.perSideCapacity-this.liquidAmount),t+=this.moderator.efficiency*this.liquidAmount,t/=this.perSideCapacity,t}moderation(){if(this.perSideCapacity==0||this.moderator==null)return this.defaultModerator.moderation;let t=0;return t+=this.moderator.moderation*(this.perSideCapacity-this.liquidAmount),t+=this.moderator.moderation*this.liquidAmount,t/=this.perSideCapacity,t}heatConductivity(){if(this.perSideCapacity==0||this.moderator==null)return this.defaultModerator.conductivity;let t=0;return t+=this.moderator.conductivity*(this.perSideCapacity-this.liquidAmount),t+=this.moderator.conductivity*this.liquidAmount,t/=this.perSideCapacity,t}}class de{constructor(e){r(this,"capacity");r(this,"fuel",0);r(this,"waste",0);r(this,"partialUsed",0);r(this,"burnedLastTick",0);this.capacity=e}burn(e){if(e==1/0||e==0){this.burnedLastTick=0;return}let t=this.partialUsed+e;if(t=Math.min(t,this.fuel),this.burnedLastTick=t-this.partialUsed,this.partialUsed=t,t>=1){let i=t;this.fuel-=i,this.waste+=i,this.partialUsed-=i}}totalStored(){return this.fuel+this.waste}insertFuel(e,t){return this.totalStored()>=this.capacity?0:(e=Math.min(e,this.capacity-this.totalStored()),t||(this.fuel+=e),e)}insertWaste(e,t){return this.totalStored()>=this.capacity?0:(e=Math.min(e,this.capacity-this.totalStored()),t||(this.waste+=e),e)}extractFuel(e,t){return e=Math.min(this.fuel,e),t||(this.fuel-=e),e}extractWaste(e,t){return e=Math.min(this.waste,e),t||(this.waste-=e),e}}class W{constructor(e,t){r(this,"x");r(this,"y");this.x=e,this.y=t}}class k{constructor(e,t,i){r(this,"x");r(this,"y");r(this,"z");this.x=e,this.y=t,this.z=i}setComponent(e,t){e==0?this.x=t:e==1?this.y=t:this.z=t}add(e,t,i){return this.x+=e,this.y+=t,this.z+=i,this}floor(){this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z)}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){let e=this.length();return this.x/=e,this.y/=e,this.z/=e,this}maxComponent(){return Math.abs(this.x)>Math.abs(this.y)&&Math.abs(this.x)>Math.abs(this.z)?0:Math.abs(this.y)>Math.abs(this.z)?1:2}mul(e){return this.x*=e,this.y*=e,this.z*=e,this}divVec(e){this.x/=e.x,this.y/=e.y,this.z/=e.z}set(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}absolute(){this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z)}get(e){return e==0?this.x:e==1?this.y:this.z}}const fe=[new W(-1,0),new W(1,0),new W(0,1),new W(0,-1)],me=[new k(1,0,0),new k(-1,0,0),new k(0,1,0),new k(0,-1,0),new k(0,0,1),new k(0,0,-1)];class ge{constructor(e){r(this,"x");r(this,"y");r(this,"z");r(this,"defaultModerator");r(this,"moderatorProperties",[]);r(this,"controlRodsXZ",[]);r(this,"controlRods",[]);r(this,"fuelToCasingRFKT");r(this,"fuelToManifoldSurfaceArea");r(this,"stackToCoolantSystemRFKT");r(this,"casingToAmbientRFKT");r(this,"fuelHeat",new V);r(this,"stackHeat",new V);r(this,"ambientHeat",new V);r(this,"battery");r(this,"coolantTank");r(this,"output");r(this,"fuelTank");r(this,"fuelFertility",1);if(this.x=e.x,this.y=e.y,this.z=e.z,this.defaultModerator=e.defaultModeratorProperties,e.passivelyCooled)this.output=this.battery=new ce(((e.x+2)*(e.y+2)*(e.z+2)-e.x*e.y*e.z)*f.Reactor.PassiveBatteryPerExternalBlock),this.coolantTank=null;else{let s=this.controlRods.length*e.y*f.Reactor.CoolantTankAmountPerFuelRod;s+=e.manifoldCount*f.Reactor.CoolantTankAmountPerFuelRod,this.output=this.coolantTank=new G(s,e.defaultModeratorProperties),this.battery=null}this.moderatorProperties=[];for(let s=0;s<e.x;s++){let l=[];for(let a=0;a<e.y;a++){let c=[];for(let m=0;m<e.z;m++){let d=e.moderatorProperties[s][a][m];e.manifoldLocations[s][a][m]&&(d=this.coolantTank.moderator),d==null&&(d=this.defaultModerator),c.push(d)}l.push(c)}this.moderatorProperties.push(l)}this.controlRodsXZ=[];for(let s=0;s<e.x;s++){let l=[];for(let a=0;a<e.z;a++)if(e.controlRodLocations[s][a]){let c=new he(s,a);l.push(c),this.controlRods.push(c);for(let m=0;m<e.y;m++)this.moderatorProperties[s][m][a]=null}else l.push(null);this.controlRodsXZ.push(l)}this.fuelTank=new de(f.Reactor.PerFuelRodCapacity*this.controlRods.length*e.y);let t=0,i=0;for(let s of this.controlRods)for(let l=0;l<e.y;l++)for(let a of fe){if(s.x+a.x<0||s.x+a.x>=this.x||s.y+a.y<0||s.y+a.y>=this.z){t+=f.Reactor.CasingHeatTransferRFMKT;continue}let c=this.moderatorProperties[s.x+a.x][l][s.y+a.y];c!=null&&(c instanceof G?i++:t+=c.conductivity)}t*=f.Reactor.FuelToStackRFKTMultiplier;let n=2*(this.x*this.y+this.x*this.z+this.z*this.y);for(let s=0;s<this.x;s++)for(let l=0;l<this.y;l++)for(let a=0;a<this.z;a++)if(this.moderatorProperties[s][l][a]instanceof G)for(let m of me){let d=s+m.x,R=l+m.y,M=a+m.z;if(d<0||d>=this.x||R<0||R>=this.y||M<0||M>=this.z){n--;continue}this.moderatorProperties[d][R][M]instanceof G||n++}n*=f.Reactor.StackToCoolantRFMKT,e.passivelyCooled&&(n*=f.Reactor.PassiveCoolingTransferEfficiency),this.casingToAmbientRFKT=2*((this.x+2)*(this.y+2)+(this.x+2)*(this.z+2)+(this.z+2)*(this.y+2))*f.Reactor.StackToAmbientRFMKT,this.fuelToCasingRFKT=t,this.fuelToManifoldSurfaceArea=i,this.stackToCoolantSystemRFKT=n,this.fuelHeat.rfPerKelvin=this.controlRods.length*this.y*f.Reactor.RodFEPerUnitVolumeKelvin,this.stackHeat.rfPerKelvin=this.x*this.y*this.z*f.Reactor.RodFEPerUnitVolumeKelvin,this.ambientHeat.isInfinite=!0,this.ambientHeat.temperature=e.ambientTemperature,this.stackHeat.temperature=e.ambientTemperature,this.fuelHeat.temperature=e.ambientTemperature,this.battery!=null&&(this.battery.temperature=e.ambientTemperature)}startNextRadiate(){}tick(e){let t=0;e?t=this.radiate():this.fuelTank.burn(0);let i=f.Reactor.FuelFertilityDecayDenominator;e||(i*=f.Reactor.FuelFertilityDecayDenominatorInactiveMultiplier),this.fuelFertility=Math.max(0,this.fuelFertility-Math.max(f.Reactor.FuelFertilityMinimumDecay,this.fuelFertility/i)),this.fuelHeat.transferWith(this.stackHeat,this.fuelToCasingRFKT+this.fuelToManifoldSurfaceArea*(this.coolantTank==null?this.defaultModerator.conductivity:this.coolantTank.moderator.conductivity)),this.output.transferWith(this.stackHeat,this.stackToCoolantSystemRFKT),this.stackHeat.transferWith(this.ambientHeat,this.casingToAmbientRFKT),e&&(this.startNextRadiate(),this.fuelTank.burn(t))}fertility(){return this.fuelFertility<=1?1:Math.log10(this.fuelFertility)+1}}class q{constructor(e,t){r(this,"offset");r(this,"length");this.offset=e,this.length=t}}r(q,"rays",[]);{q.rays=[];let u=f.Reactor.IrradiationDistance,e=f.SimulationRays,t=e-1,i=[],n=Math.PI*(3-Math.sqrt(5));for(let y=0;y<e;y++){let h=1-y*2/t,g=Math.sqrt(1-h*h),w=n*y,_=Math.cos(w)*g,b=Math.sin(w)*g;i.push(new k(_,h,b).normalize())}let s=new k(0,0,0),l=new k(0,0,0),a=new k(0,0,0),c=new k(0,0,0),m=new k(0,0,0),d=new k(0,0,0),R=0,M=[new k(0,0,0),new k(0,0,0),new k(0,0,0)];for(let y of i){let h=[];s.set(y),s.normalize(),a.set(s),a.mul(1/Math.abs(a.get(a.maxComponent()))),a.mul(.5),s.mul(u+a.length()),R=0;let g=s.length();a.mul(0),d.set(s),d.absolute(),d.divVec(s),d.mul(.5);let w=!0,_=0;for(;_<5e5;){_++;for(let E=0;E<3;E++){let x=M[E];x.set(s);let C=x.get(E),I=d.get(E);x.mul(I/C)}let b=0,F=1/0;for(let E=0;E<3;E++){let x=M[E].length();x<F&&(b=E,F=x)}d.setComponent(b,d.get(b)+d.get(b)/Math.abs(d.get(b))),c.set(M[b]),l.set(c).sub(a),m.set(c).sub(a).mul(.5).add(.5,.5,.5).add(a.x,a.y,a.z).floor();let S=l.length(),H=R+S>=g;if(S=Math.min(g-R,S),!w&&S!=0&&h.push(new q(new k(m.x,m.y,0),S)),w=!1,R+=S,H)break;a.set(c)}q.rays.push(h)}console.log("Finished ray sim")}class pe extends ge{constructor(t){super(t);r(this,"currentRod",0);r(this,"rodOffset",0)}radiate(){if(this.fuelTank.fuel<=0)return 0;this.currentRod++,this.currentRod>=this.controlRods.length&&(this.currentRod=0,this.rodOffset++);let t=this.currentRod%this.y,i=this.currentRod+this.rodOffset;i%=this.controlRods.length;let n=Math.exp(-f.Reactor.RadPenaltyShiftMultiplier*Math.exp(-.001*f.Reactor.RadPenaltyRateMultiplier*(this.fuelHeat.temperature-273.15))),l=(this.fuelTank.fuel+this.fuelTank.waste/100)*f.Reactor.FissionEventsPerFuelUnit,a=Math.pow(Math.pow(l,f.Reactor.FuelReactivity)/this.controlRods.length,f.Reactor.FuelReactivity)*this.controlRods.length,c=Math.min(1,.2+.8*n),m=1+-f.Reactor.RadIntensityScalingMultiplier*Math.exp(-10*f.Reactor.RadIntensityScalingShiftMultiplier*Math.exp(-.001*f.Reactor.RadIntensityScalingRateExponentMultiplier*(this.fuelHeat.temperature-273.15))),d=1-f.Reactor.FuelAbsorptionScalingMultiplier*Math.exp(-10*f.Reactor.FuelAbsorptionScalingShiftMultiplier*Math.exp(-.001*f.Reactor.FuelAbsorptionScalingRateExponentMultiplier*(this.fuelHeat.temperature-273.15))),R=1/f.Reactor.FuelHardnessDivisor,M=0,y=0,h=0,g=0,w=this.controlRods[i],_=(100-w.insertion)/100,b=a*_,F=l*_,S=b*m;M+=f.Reactor.FuelPerRadiationUnit*F/this.fertility()*f.Reactor.FuelUsageMultiplier,y+=f.Reactor.FEPerRadiationUnit*S;let H=1/q.rays.length;for(let E=0;E<q.rays.length;E++){let x=q.rays[E],C=c,I=S*H;for(let v=0;v<x.length;v++){let T=x[v],L=w.x+T.offset.x,A=t+T.offset.y,U=w.y+T.offset.z;if(L<0||L>=this.x||A<0||A>=this.y||U<0||U>=this.z)break;let K=this.moderatorProperties[L][A][U];if(K!=null){let z=I*K.absorption*(1-C)*T.length;I=Math.max(0,I-z),C=C/((K.moderation-1)*T.length+1),g+=K.efficiency*z*f.Reactor.FEPerRadiationUnit}else{let z=this.controlRodsXZ[L][U].insertion*.001,D=d*(1-C*R)*f.Reactor.FuelAbsorptionCoefficient*T.length,re=(1-D)*z*.5,oe=D*z*.5,ee=(D+re)*I,se=(D-oe)*I,ne=f.Reactor.FuelModerationFactor+(f.Reactor.FuelModerationFactor*z+z);I=Math.max(0,I-ee),C=C/((ne-1)*T.length+1),y+=ee*f.Reactor.FEPerRadiationUnit,h+=se}}}return Number.isNaN(h)||(h*=f.Reactor.fuelRadScalingMultiplier*(f.Reactor.PerFuelRodCapacity/Math.max(1,this.fuelTank.totalStored())),this.fuelFertility+=h),Number.isNaN(y)||this.fuelHeat.absorbRF(y),Number.isNaN(g)||this.stackHeat.absorbRF(g),M}refuel(){this.fuelTank.fuel=this.fuelTank.capacity,this.fuelTank.partialUsed=0,this.fuelTank.waste=0}get_width(){return this.x}get_depth(){return this.z}get_height(){return this.y}get_generated(){return this.battery.generatedLastTick}get_energy(){return this.battery.stored}get_energy_capacity(){return this.battery.capacity}get_stack_temperature(){return this.stackHeat.temperature}get_fuel_temperature(){return this.fuelHeat.temperature}get_fuel_burned(){return this.fuelTank.burnedLastTick}get_fuel(){return this.fuelTank.fuel}get_fuel_capacity(){return this.fuelTank.capacity}get_waste(){return this.fuelTank.waste}get_fertility(){return this.fertility()}set_control_rod(t,i){this.controlRods[t].insertion=i}get_control_rod(t){return this.controlRods[t].insertion}get_control_rod_count(){return this.controlRods.length}}const Z={COMMON:{general:{powerProductionMultiplier:1,fuelUsageMultiplier:1},reactor:{reactorPowerProductionMultiplier:1}}};class ye{constructor(e,t){r(this,"x");r(this,"z");r(this,"insertion",0);this.x=e,this.z=t}}class P{static getEnergyFromVolumeAndTemperature(e,t){return t*e*this.ENERGY_PER_CENTIGRADE_PER_UNIT_VOLUME}static getTemperatureFromVolumeAndEnergy(e,t){return t/(e*this.ENERGY_PER_CENTIGRADE_PER_UNIT_VOLUME)}}r(P,"ENERGY_PER_RADIATION_UNIT",10),r(P,"ENERGY_PER_CENTIGRADE_PER_UNIT_VOLUME",10);class j{constructor(e,t,i,n,s){r(this,"moderationFactor");r(this,"absorptionCoefficient");r(this,"hardnessDivisor");r(this,"fissionEventsPerFuelUnit");r(this,"fuelUnitsPerFissionEvent");this.moderationFactor=e,this.absorptionCoefficient=t,this.hardnessDivisor=i,this.fissionEventsPerFuelUnit=n,this.fuelUnitsPerFissionEvent=s}}r(j,"DEFAULT",{moderationFactor:1.5,absorptionCoefficient:.5,hardnessDivisor:1,fissionEventsPerFuelUnit:.01,fuelUnitsPerFissionEvent:7e-4}),r(j,"INVALID",{moderationFactor:1,absorptionCoefficient:0,hardnessDivisor:1,fissionEventsPerFuelUnit:0,fuelUnitsPerFissionEvent:0});class _e{constructor(e,t,i){r(this,"worldPosition");r(this,"irradiationDirections",[new k(0,0,1),new k(-1,0,0),new k(0,0,-1),new k(1,0,0)]);r(this,"linked",null);this.worldPosition=new k(e,t,i)}}class be{constructor(){r(this,"fuelRods",[]);r(this,"map",{});r(this,"currentSlice",0);r(this,"currentIndex",0);r(this,"verticalSlices",{})}set_rod(e,t,i){let n=new _e(e,t,i);return this.verticalSlices[t]||(this.verticalSlices[t]=[]),this.verticalSlices[t].push(n),this.fuelRods.push(n),this.map[`${e} ${t} ${i}`]=this.fuelRods.length-1,n}get_rod(e,t,i){return this.fuelRods[this.map[`${e} ${t} ${i}`]]}size(){return this.fuelRods.length}get_heat_transfer_rate(e){let t=0;for(let i of this.fuelRods){let n=i.worldPosition,s=0;for(let l of i.irradiationDirections){let a=new k(n.x+l.x,n.y+l.y,n.z+l.z);if(a.x<0||a.y<0||a.z<0||a.x>=e.length||a.y>=e[0].length||a.z>=e[0][0].length){s+=.6;continue}let c=e[a.x][a.y][a.z];if(c.id=="minecraft:air"){s+=.05;continue}c.id!="biggerreactors:fuel_rod"&&(s+=c.conductivity)}t+=s}return t}get_next(e){if(this.fuelRods.length==0)return null;let t=this.verticalSlices[this.currentSlice][this.currentIndex];return++this.currentIndex>=this.verticalSlices[this.currentSlice].length&&(this.currentIndex=0,this.currentSlice=(this.currentSlice+1)%e),t}}const B=class B{constructor(e,t,i,n,s,l,a,c,m,d,R){r(this,"name");r(this,"radiationAttenuation");r(this,"residualRadiationAttenuation");r(this,"solidFuelConversionEfficiency");r(this,"fluidFuelConversionEfficiency");r(this,"partEnergyCapacity");r(this,"energyGenerationEfficiency");r(this,"maxEnergyExtractionRate");r(this,"partFluidCapacity");r(this,"maxFluidCapacity");r(this,"vaporGenerationEfficiency");this.name=e,this.radiationAttenuation=t,this.residualRadiationAttenuation=i,this.solidFuelConversionEfficiency=n,this.fluidFuelConversionEfficiency=s,this.partEnergyCapacity=l,this.energyGenerationEfficiency=a,this.maxEnergyExtractionRate=c,this.partFluidCapacity=m,this.maxFluidCapacity=d,this.vaporGenerationEfficiency=R}solidSourceAmountToReactantAmount(e){return Math.floor(e*this.solidFuelConversionEfficiency)}reactantAmountToSolidSourceAmount(e){return Math.floor(e/this.solidFuelConversionEfficiency)}fluidSourceAmountToReactantAmount(e){return Math.floor(e*this.fluidFuelConversionEfficiency)}reactantAmountToFluidSourceAmount(e){return Math.floor(e/this.fluidFuelConversionEfficiency)}};r(B,"Basic",new B("basic",.9,.1,.5,0,1e4,.8,5e4,0,0,0)),r(B,"Reinforced",new B("reinforced",.75,.15,.75,.95,3e4,.85,5e6,1e3,2e5,.85));let J=B;class Re{constructor(){r(this,"fuelUsage",0);r(this,"environmentEnergyAbsorption",0);r(this,"fuelEnergyAbsorption",0);r(this,"fuelAbsorbedRadiation",0)}getEnvironmentHeatChange(e){return P.getTemperatureFromVolumeAndEnergy(e,this.environmentEnergyAbsorption)}getFuelHeatChange(e){return P.getTemperatureFromVolumeAndEnergy(e,this.fuelEnergyAbsorption)}}class we{constructor(){r(this,"hardness",0);r(this,"intensity",0)}}class ke{constructor(e,t,i){r(this,"width");r(this,"depth");r(this,"height");r(this,"blocks",[]);r(this,"mode","passive");r(this,"variant",J.Reinforced);r(this,"fuelProperties",j.DEFAULT);r(this,"fuelToReactorHeatTransferCoefficient",0);r(this,"reactorToCoolantSystemHeatTransferCoefficient",0);r(this,"reactorHeatLossCoefficient",0);r(this,"fertility",1);r(this,"reactorHeat",0);r(this,"coolantTemp",0);r(this,"fuelCapacity",11048);r(this,"fuelAmount",0);r(this,"wasteAmount",0);r(this,"fuelHeat",0);r(this,"fuelUsedLastTick",0);r(this,"radiationFuelUsage",0);r(this,"energyCapacity",1e9);r(this,"storedEnergy",0);r(this,"generatedLastTick",0);r(this,"controlRods",[]);r(this,"fuelRods",new be);this.width=e,this.depth=t,this.height=i;for(let n=0;n<e;n++){let s=[];for(let l=0;l<i;l++){let a=[];for(let c=0;c<t;c++)a.push(o.EMPTY_MODERATOR);s.push(a)}this.blocks.push(s)}this.reactorToCoolantSystemHeatTransferCoefficient=.6*this.internalSurfaceArea(),this.reactorHeatLossCoefficient=.001*this.externalSurfaceArea(),this.set_fertility(1)}set_block(e,t,i,n){if(this.blocks[e][t][i]=n,n==o.FUEL_ROD){this.fuelRods.set_rod(e,t,i);for(let s=0;s<this.controlRods.length;s++)if(this.controlRods[s].x==e&&this.controlRods[s].z==i){this.fuelRods.get_rod(e,t,i).linked=this.controlRods[s];break}}}add_control_rod(e,t,i){if(i)this.controlRods.push(new ye(e,t));else for(let n=0;n<this.controlRods.length;n++)if(this.controlRods[n].x==e&&this.controlRods[n].z==t){this.controlRods.splice(n,1);break}}update_fuel_rods(){this.fuelToReactorHeatTransferCoefficient=this.fuelRods.get_heat_transfer_rate(this.blocks),this.fuelCapacity=this.fuelRods.size()*4e3;let t=(this.width+2)*(this.depth+2)*(this.height+2)-this.getReactorVolume()+this.fuelRods.size();this.energyCapacity=this.variant.partEnergyCapacity*t}internalSurfaceArea(){return 2*(this.width*this.height+this.width*this.depth+this.height*this.depth)}externalSurfaceArea(){return 2*((this.width+2)*(this.height+2)+(this.width+2)*(this.depth+2)+(this.height+2)*(this.depth+2))}performIrradiation(e){if(!e)return;let t=this.fuelRods.get_next(this.height);t&&this.performIrradiationFrom(t)}performIrradiationFrom(e){let t=this.radiate(e,this.fuelHeat,this.get_control_rod_count());t&&(this.fuelHeat+=t.getFuelHeatChange(this.fuelRods.size()),this.reactorHeat+=t.getEnvironmentHeatChange(this.getReactorVolume()),this.fuelUsedLastTick=t.fuelUsage)}transferHeatBetweenFuelAndReactor(){let e=this.fuelHeat-this.reactorHeat;if(e>.01){let t=e*this.fuelToReactorHeatTransferCoefficient,i=P.getEnergyFromVolumeAndTemperature(this.fuelRods.size(),this.fuelHeat)-t,n=P.getEnergyFromVolumeAndTemperature(this.getReactorVolume(),this.reactorHeat)+t;this.fuelHeat=P.getTemperatureFromVolumeAndEnergy(this.fuelRods.size(),i),this.reactorHeat=P.getTemperatureFromVolumeAndEnergy(this.getReactorVolume(),n)}}transferHeatBetweenReactorAndCoolant(){let e=this.reactorHeat-this.coolantTemp;if(e>.01){let t=e*this.reactorToCoolantSystemHeatTransferCoefficient,i=P.getEnergyFromVolumeAndTemperature(this.getReactorVolume(),this.reactorHeat);if(this.mode=="passive")t*=.2,this.generateEnergy(t*.5);else throw new Error("Active reactors not implemented");i-=t,this.reactorHeat=P.getTemperatureFromVolumeAndEnergy(this.getReactorVolume(),i)}}getReactorVolume(){return this.width*this.depth*this.height}generateEnergy(e){e=e*Z.COMMON.general.powerProductionMultiplier*Z.COMMON.reactor.reactorPowerProductionMultiplier*this.variant.energyGenerationEfficiency,this.storedEnergy+=e,this.generatedLastTick=e}moderateRadiationForFuelRod(e,t,i){if(!e.linked)return;let n=(1-.95*Math.exp(-10*Math.exp(-.0022*this.fuelHeat)))*(1-i.hardness/this.fuelProperties.hardnessDivisor),s=Math.min(1,n*this.fuelProperties.absorptionCoefficient),l=(1-s)*e.linked.insertion*.5,a=s*e.linked.insertion*.5,c=(s+l)*i.intensity,m=(s-a)*i.intensity,d=this.fuelProperties.moderationFactor;d+=d*e.linked.insertion+e.linked.insertion,i.intensity=Math.max(0,i.intensity-c),i.hardness/=d,t.fuelEnergyAbsorption+=c*P.ENERGY_PER_RADIATION_UNIT,t.fuelAbsorbedRadiation+=m}moderateRadiation(e,t,i){let n=i.intensity*e.absorption*(1-i.hardness);i.intensity=Math.max(0,i.intensity-n),i.hardness/=e.moderation,t.environmentEnergyAbsorption+=e.efficiency*n*P.ENERGY_PER_RADIATION_UNIT}onIrradiation(e){if(!isFinite(e)||isNaN(e)||(this.radiationFuelUsage+=e,this.radiationFuelUsage<1))return;let t=Math.min(this.fuelAmount,this.radiationFuelUsage);t<=0||(this.radiationFuelUsage=Math.max(0,this.radiationFuelUsage-t),this.fuelAmount-=t,this.wasteAmount+=t)}radiate(e,t,i){if(this.fuelAmount<=0)return null;let n=Math.exp(-15*Math.exp(-.0025*t)),s=this.fuelAmount+this.wasteAmount/100,l=1.05,a=s*this.fuelProperties.fissionEventsPerFuelUnit,c=Math.pow(a,l);c=Math.pow(c/i,l)*i;let m=(100-e.linked.insertion)/100;c=c*m,a=a*m;let d=c*(1+-.95*Math.exp(-10*Math.exp(-.0012*t))),R=.2+.8*n,M=this.fuelProperties.fuelUnitsPerFissionEvent*a/this.getFertilityModifier()*Z.COMMON.general.fuelUsageMultiplier,y=new Re;y.environmentEnergyAbsorption=0,y.fuelAbsorbedRadiation=0,y.fuelEnergyAbsorption=P.ENERGY_PER_RADIATION_UNIT*d;let h=e.worldPosition,g=new k(h.x,h.y,h.z),w=new we;d*=.25;for(let _ of e.irradiationDirections){w.hardness=R,w.intensity=d,g=new k(h.x,h.y,h.z);let b=4;for(;b>0&&w.intensity>1e-4;){if(b--,g.add(_.x,_.y,_.z),g.x<0||g.y<0||g.z<0||g.x>=this.width||g.y>=this.height||g.z>=this.depth){w.intensity=0;continue}let F=this.blocks[g.x][g.y][g.z];F?F.id=="biggerreactors:fuel_rod"?this.moderateRadiationForFuelRod(e,y,w):this.moderateRadiation(F,y,w):w.intensity=0}}return this.fertility+=y.fuelAbsorbedRadiation,y.fuelAbsorbedRadiation=0,this.onIrradiation(M),y.fuelUsage=M,y}performRadiationDecay(e){let t=20;e||(t*=200),this.fertility=Math.max(0,this.fertility-Math.max(.1,this.fertility/t))}performPassiveHeatLoss(){let e=this.reactorHeat-20;if(e>1e-6){let t=Math.max(1,e*this.reactorHeatLossCoefficient),i=Math.max(0,P.getEnergyFromVolumeAndTemperature(this.getReactorVolume(),this.reactorHeat)-t);this.reactorHeat=P.getTemperatureFromVolumeAndEnergy(this.getReactorVolume(),i)}}getFertilityModifier(){return this.fertility<=1?1:Math.log10(this.fertility)+1}set_fertility(e){!isFinite(e)||isNaN(e)?this.fertility=1:this.fertility=Math.max(this.fertility,0)}tick(e){this.performIrradiation(e),this.performRadiationDecay(e),this.transferHeatBetweenFuelAndReactor(),this.transferHeatBetweenReactorAndCoolant(),this.performPassiveHeatLoss(),this.reactorHeat=Math.max(this.reactorHeat,0),this.fuelHeat=Math.max(this.fuelHeat,0),e||(this.fuelUsedLastTick=0),this.storedEnergy>this.energyCapacity&&(this.storedEnergy=this.energyCapacity)}refuel(){this.fuelAmount=this.fuelCapacity,this.wasteAmount=0,this.storedEnergy=0}get_width(){return this.width}get_depth(){return this.depth}get_height(){return this.height}get_generated(){return this.generatedLastTick}get_energy(){return this.storedEnergy}get_energy_capacity(){return this.energyCapacity}get_stack_temperature(){return this.reactorHeat}get_fuel_temperature(){return this.fuelHeat}get_fuel_burned(){return this.fuelUsedLastTick}get_fuel(){return this.fuelAmount}get_fuel_capacity(){return this.fuelCapacity}get_waste(){return this.wasteAmount}get_fertility(){return this.fuelAmount+this.wasteAmount<=0?0:this.fuelAmount/(this.fuelAmount+this.wasteAmount)}set_control_rod(e,t){this.controlRods[e].insertion=t}get_control_rod(e){return this.controlRods[e].insertion}get_control_rod_count(){return this.controlRods.length}}class Q{constructor(){r(this,"blocks");r(this,"version");r(this,"width");r(this,"depth");r(this,"height");this.version="extremereactors_1.20",this.width=3,this.depth=3,this.height=3,this.blocks={}}clear(){this.blocks={}}set_block(e,t,i){this.blocks[`${e} ${t}`]=i}get_block(e,t){let i=this.blocks[`${e} ${t}`];return $[this.version]?i||(i=$[this.version]["minecraft:air"]):i=o.EMPTY_MODERATOR,i||(i=o.EMPTY_MODERATOR),i}get_simulation(){if(this.version=="extremereactors"){let e=new ke(this.width,this.depth,this.height);for(let t=0;t<this.width;t++)for(let i=0;i<this.depth;i++){let n=this.get_block(t,i);n.id=="biggerreactors:fuel_rod"&&e.add_control_rod(t,i,!0);for(let s=0;s<this.height;s++)e.set_block(t,s,i,n)}return e.update_fuel_rods(),e}else{let e=new ue;e.setSize(this.width,this.height,this.depth);for(let t=0;t<this.width;t++)for(let i=0;i<this.depth;i++){let n=this.get_block(t,i);if(n.id=="biggerreactors:fuel_rod"){e.setControlRod(t,i,!0);continue}e.setControlRod(t,i,!1);for(let s=0;s<this.height;s++)e.setModeratorProperties(t,s,i,n)}return new pe(e)}}static parse(e){let t=JSON.parse(e),i=new Q;i.version=t.version,i.width=t.width,i.depth=t.depth,i.height=t.height;for(let n in t.blocks)i.blocks[n]=t.blocks[n];return i}}const Te="#202020",Me="#316B1F",Fe="#4FAE0B",ve="#46A701",Y=1.5;let p=new Q,N=null;const Ee=()=>{let u=document.querySelector(".material-list"),e=null;const t=n=>{N=n},i=()=>{u.innerHTML="";for(const n in $[p.version]){let s=$[p.version][n],l=document.createElement("button");l.innerHTML=s.displayName,l.addEventListener("click",()=>{e&&(e.className=""),l.className="selected-element-btn",e=l,t(s.id)}),u.appendChild(l)}};return i(),i},Ae=()=>{let u=p.get_simulation(),e=document.querySelector("#reactor-size-lbl"),t=document.querySelector("#temp-stat"),i=document.querySelector("#gen-stat"),n=document.querySelector("#fuel-use-stat"),s=document.querySelector("#rf-per-stat"),l=document.querySelector("#react-stat"),a=document.querySelector("#fuel-stat"),c=document.querySelector("#waste-stat"),m=document.querySelector("#bat-stat"),d=document.querySelector("#fuel-bar"),R=document.querySelector("#waste-bar"),M=document.querySelector("#case-heat-bar"),y=document.querySelector("#fuel-heat-bar"),h=document.querySelector("#battery-bar"),g=document.querySelector("#reactor-active-toggle"),w=document.querySelector("#reactor-refuel-btn"),_=document.querySelector(".rods"),b=document.querySelector("#control-rod-lock");const F=(v,T)=>Math.round(v*T)/T,S=v=>v>=1e6?[F(v/1e6,100),"MiRF/t"]:v>=1e3?[F(v/1e3,100),"KiRF/t"]:[Math.round(v),"RF/t"],H=(v,T)=>{v.style.top=`${(1-T)*100}%`,v.style.height=`${T*100}%`},E=()=>{u=p.get_simulation()},x=()=>{if(_.innerHTML="",u.get_control_rod_count()==0){_.innerHTML="No control rods";return}const v=(T,L,A)=>{u.set_control_rod(T,Number.parseFloat(L.value)),A.innerHTML=`Rod ${T+1} at ${L.value}% insertion`};for(let T=0;T<u.get_control_rod_count();T++){let L=document.createElement("div");L.className="control-rod-slider";let A=document.createElement("input");A.type="range",A.min="0",A.max="100",A.value="0",A.step="0.1";let U=document.createElement("span");U.innerHTML=`Rod ${T+1} at ${A.value}% insertion`,A.addEventListener("input",()=>{v(T,A,U),b.checked&&document.querySelectorAll(".control-rod-slider").forEach((z,X)=>{if(X==T)return;let D=z.querySelector("input");D.value=A.value,v(X,D,z.querySelector("span"))})}),L.appendChild(U),L.appendChild(A),_.appendChild(L)}},C=()=>{e.innerHTML=`Inner Dimensions: ${p.width}x${p.depth}x${p.height}<br>Outer Dimensions: ${p.width+2}x${p.depth+2}x${p.height+2}`;let[v,T]=S(u.get_generated());t.innerHTML=`Temperature: ${F(u.get_fuel_temperature(),1)} K`,i.innerHTML=`Generation: ${v} ${T}`,n.innerHTML=`Fuel usage: ${F(u.get_fuel_burned(),1e3)} mB/t`,s.innerHTML=`RF per fuel: ${u.get_fuel_burned()==0?0:F(v/u.get_fuel_burned(),1e3)} RF/mB/t`,l.innerHTML=`Reactivity: ${F(u.get_fertility()*100,10)}%`,a.innerHTML=`Fuel: ${Math.round(u.get_fuel())}/${Math.round(u.get_fuel_capacity())}`,c.innerHTML=`Waste: ${Math.round(u.get_waste())}/${Math.round(u.get_fuel_capacity())}`,m.innerHTML=`Battery: ${Math.round(u.get_energy())}/${Math.round(u.get_energy_capacity())}`,H(d,u.get_fuel()/u.get_fuel_capacity()),H(R,u.get_waste()/u.get_fuel_capacity()),H(M,Math.min(u.get_stack_temperature()/2e3,1)),H(y,Math.min(u.get_fuel_temperature()/2e3,1)),H(h,u.get_energy()/u.get_energy_capacity())},I=()=>{setInterval(()=>{u.tick(g.checked),C()},50)};return w.addEventListener("click",()=>{u.refuel(),C()}),C(),I(),{update_tags:C,create_new_sim:E,update_rods:x}},Se=(u,e,t)=>{let i=document.querySelector("#reactor-canvas"),n=i.getContext("2d"),s=0,l=0,a=!1;const c=h=>$[p.version][h],m=h=>({x:h.clientX-i.getBoundingClientRect().left,y:h.clientY-i.getBoundingClientRect().top}),d=h=>{let g=m(h);s=Math.floor(g.x/(i.width/(p.width+2))),l=Math.floor(g.y/(i.height/(p.depth+2)))},R=()=>{n.clearRect(0,0,i.width,i.height);let h=i.width/(p.width+2),g=i.height/(p.depth+2);const w=(_,b,F,S)=>{let H=h*_+Y/2,E=g*b+Y/2,x=h-Y,C=g-Y;n.fillStyle=F,n.fillRect(H,E,x,C),S&&(n.font=`${30*(h/195)}px Arial`,n.textAlign="center",n.fillStyle="#ffffff",n.fillText(S,h*_+h/2,g*b+g/2+10))};for(let _=0;_<p.width+2;_++)for(let b=0;b<p.depth+2;b++){if(_==0||_==p.width+1||b==0||b==p.depth+1){w(_,b,Te);continue}let F=p.get_block(_-1,b-1);s==_&&l==b?w(_,b,a?ve:Fe,F.displayName):w(_,b,Me,F.displayName)}},M=()=>{i.style.aspectRatio=(p.width/p.depth).toString(),i.width=i.offsetWidth,i.height=i.offsetHeight,R()},y=()=>{N==null&&(N="minecraft:air");let h=p.get_block(s-1,l-1).id=="biggerreactors:fuel_rod";p.set_block(s-1,l-1,c(N)),e(),u(),(N=="biggerreactors:fuel_rod"||h)&&t()};return M(),window.addEventListener("resize",()=>{M(),R()}),i.addEventListener("mousemove",h=>{d(h),a&&N&&y(),R()}),i.addEventListener("mousedown",h=>{a=!0,d(h),N&&y(),R()}),i.addEventListener("mouseup",h=>{a=!1,d(h),R()}),{refresh_canvas:R,resize_canvas:M}},Ce=(u,e,t,i,n)=>{let s=document.querySelector("#reactor-modal"),l=document.querySelector("#new-reactor-btn"),a=document.querySelector("#reactor-submit-btn"),c=document.querySelector("#reactor-version-txt"),m=document.querySelector("#reactor-width-txt"),d=document.querySelector("#reactor-depth-txt"),R=document.querySelector("#reactor-height-txt");const M=()=>{s.style.display="block",m.value=`${p.width}`,d.value=`${p.depth}`,R.value=`${p.height}`},y=()=>{s.style.display="none"},h=()=>{p.width=Number.parseInt(m.value),p.depth=Number.parseInt(d.value),p.height=Number.parseInt(R.value),t(),e(),n(),i()},g=()=>{p.clear(),p.version=c.value,u(),e()};c.addEventListener("change",g),m.addEventListener("change",h),d.addEventListener("change",h),R.addEventListener("change",h),l.addEventListener("click",M),a.addEventListener("click",y),window.addEventListener("click",w=>{w.target==s&&y()}),g()},Pe=Ee(),{update_tags:te,create_new_sim:ie,update_rods:xe}=Ae(),{refresh_canvas:Le,resize_canvas:He}=Se(te,ie,xe);Ce(Pe,Le,He,te,ie);
